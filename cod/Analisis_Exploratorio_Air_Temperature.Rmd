---
title: "Exploratory data analysis of Air Temperature"
author: "Gustavo Amador Fonseca C20451"
date: "2024-10-27"
output: html_document
---

```{r setup, warning=FALSE}
# Cargando una librería para utilizar funciones específicas
library(leaflet)
library(dplyr)
library(ggplot2)
library(readr)
library(corrplot)
library(hms)

data_ori <- read_csv("C:/Users/AMADOR/OneDrive - Universidad de Costa Rica/ASISTENCIA/Fabio Sánchez/Climate_Project/data/Air_temperature/GLOBEMeasurementData-22014.csv")
#View(data_ori)
```



```{r}
# Elimiinar primer observación que no sirve
data_clea <- data_ori[-1, ]

#Cambiar nombre de columnas
data_clea <- data_clea %>% rename("userid" = "air temps:userid", "measured_at" = "air temps:measured at","solar_measured_at" = "air temps:solar measured at", "current_temp_C" = "air temps:current temp (deg C)")

# Eliminar columnas que no aportan información
data_clea <- data_clea %>% select(- "air temps:comments", -"air temps:globe teams")

# Convertir a numericas las columnas que lo deben ser
cols_numericas <- c("latitude", "longitude", "elevation")  # Especifica los nombres de las columnas
data_clea[cols_numericas] <- lapply(data_clea[cols_numericas], as.numeric)

# Separar columnas que tiene fecha y hora juntas
data_clea$fecha_measured_at <- as.Date(data_clea$`measured_at`) # Crear columna de fecha
data_clea$`hora_measured_at` <- format(data_clea$`measured_at`, format = "%H:%M:%S") # Crear columna de hora

data_clea$`fecha_solar_measured_at` <- as.Date(data_clea$`solar_measured_at`) # Crear columna de fecha
data_clea$`hora_solar_measured_at` <- format(data_clea$`solar_measured_at`, format = "%H:%M:%S") # Crear columna de hora


head(data_clea)
#View(data_clea)
```




# Análisis exploratorio de variables

## Ubicación geográfica de la toma de datos
```{r}
# Hacer las columnas de longitud y latitud son numéricas
data_ori$longitude <- as.numeric(data_ori$longitude)
data_ori$latitude <- as.numeric(data_ori$latitude)

# Crear un mapa interactivo
leaflet(data_ori) %>%
  addTiles() %>%  # Mapa base
  addCircles(
    lng = ~longitude, 
    lat = ~latitude, 
    color = "blue",  # Color de los círculos
    radius = 50,  # Ajusta el tamaño del círculo según sea necesario
    fillOpacity = 0.5,
    stroke = FALSE
  ) %>%
  addLegend("bottomright", 
            pal = colorNumeric(palette = "blue", domain = data_ori$longitude),  
            values = data_clea$longitude,  
            title = "Puntos")
```


```{r}
#print(as.numeric(data_ori$elevation))
length(data_ori$elevation)
```

## Historgrama de la variable Elevación `elevation`
```{r}

# Filtrar datos para que solo incluya elevaciones mayores que 0
data_filtered <- data_clea[as.numeric(data_clea$elevation) > 0, ]

# Crear un histograma usando ggplot con ancho de barra de 250
ggplot(data_filtered, aes(x = elevation)) + 
  geom_histogram(binwidth = 250, fill = "blue", color = "black") +  # Ancho de barra ajustado a 500
  labs(title = "Histograma de Elevación (Valores Positivos)", 
       x = "Elevación", 
       y = "Frecuencia") +
  scale_x_continuous(breaks = seq(0, max(data_filtered$elevation, na.rm = TRUE), by = 250)) +  # Establecer los breaks en el eje x
  theme_minimal()  # Estilo minimalista

```
<p> Dada la distribución obtenida, se cree que los datos de elevación sobre el nivel del mar están mal recolectados, debido a que muchos valores se encuentran cerca y de cero y menores a cero, cuando en los paises en que se tomó la muestra no tienen esa geografía</p>


## Histograma de la variable tipo de fuente de agua `current_temp_C`
```{r}
# Convertir la columna a numérica si es necesario
data_clea$current_temp_C <- as.numeric(as.character(data_clea$current_temp_C))

# Crear el histograma con ancho de barra de 1
ggplot(data_clea, aes(x = current_temp_C)) + 
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +  # Ancho de barra ajustado a 1
  labs(title = "Histograma Temperatura del Aire", 
       x = "Temperatura (°C)", 
       y = "Frecuencia") +
  theme_minimal()  # Estilo minimalista


```
## Historgrama de la variable `hora_solar_measured_at`
```{r}
# Cambiar formato de la varibale hora, a uno adecuado para graficar
data_clea$hora_solar_measured_at <- hms::as_hms(data_clea$hora_solar_measured_at)

ggplot(data_clea, aes(x = hora_solar_measured_at)) + 
  geom_histogram(binwidth = 15*60, fill = "blue", color = "black") +  # Ancho de barra de 1 hora
  labs(title = "Frecuencia de Mediciones por Hora", 
       x = "Hora del día", 
       y = "Frecuencia") +
  theme_minimal()


```
<p>Se toman intervalos de 15 minutos para graficas la distribución de las horas del día.</p>

## Historgrama de la variable `hora_measured_at`
```{r}
# Cambiar formato de la varibale hora, a uno adecuado para graficar
data_clea$hora_measured_at <- hms::as_hms(data_clea$hora_measured_at)

ggplot(data_clea, aes(x = hora_measured_at)) + 
  geom_histogram(binwidth = 15*60, fill = "blue", color = "black") +  # Ancho de barra de 1 hora
  labs(title = "Frecuencia de Mediciones por Hora", 
       x = "Hora del día", 
       y = "Frecuencia") +
  theme_minimal()


```

## Historgrama de la variable `fecha_measured_at`
```{r}
# Graficar la frecuencia de observaciones por fecha
ggplot(data_clea, aes(x = fecha_measured_at)) + 
  geom_histogram(binwidth = 30, fill = "blue", color = "black") +  # Cada barra representa 1 día
  labs(title = "Frecuencia de Observaciones por Fecha", 
       x = "Fecha", 
       y = "Frecuencia") +
  theme_minimal()

```
<p>Para graficar el historgrama se tomaron intervalos de 30 días,para poder observar la densidad de la toma de datos.</p>

# Matriz de correlación entre las variables `elevation`, `latitude`, `longitude`, `current_temp_C`, `hora_measured_decimal`, `hora_solar_decimal`
```{r}
# Convertir las varibles hora a formato hms
data_clea$hora_measured_at <- hms::as_hms(data_clea$measured_at)
data_clea$hora_solar_measured_at <- hms::as_hms(data_clea$solar_measured_at)

# Convertir ahora las variables hora a decimales
data_clea$hora_measured_decimal <- as.numeric(data_clea$hora_measured_at) / 3600
data_clea$hora_solar_decimal <- as.numeric(data_clea$hora_solar_measured_at) / 3600

# Seleccionar las columnas para la matriz de correlación
cor_data <- data_clea[, c("elevation", "latitude", "longitude", "current_temp_C", "hora_measured_decimal", "hora_solar_decimal")]

# La matriz de correlación
cor_matrix <- cor(cor_data, use = "complete.obs")
cor_matrix

# Visualizar la matriz de correlación
corrplot(cor_matrix, method = "color", type = "upper", tl.col = "black", tl.srt = 45)


```
<p>La temperatura está influenciada por la elevación de manera moderada e inversa, como es común en estudios geográficos. Hay una relación significativa entre la latitud y la longitud con respecto a la elevación, sugiriendo que los puntos de medición siguen una estructura geográfica específica. Las horas de medición (ajustadas o no) no muestran una correlación significativa con la temperatura en este conjunto de datos, lo que implica que el momento del día tiene poco impacto en los valores de temperatura observados, al menos en esta muestra.</p>





























